<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" type="text/css" href="mystyle.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Final Project</title>

    <!-- Vega and Vega-Lite Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

    <!-- Plotly Library for Treemap -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    <style>
        #chartGrid {
            display: flex;
        }

        #Location1, #Location2 {
            margin-bottom: 30px;
        }

        #Location3 {
            width: 960px;
            height: 600px;
            margin-bottom: 30px;
        }
    </style>
</head>

<body>
    <header>
        <h2> More Money, Better Health? The Efficiency Puzzle of Healthcare Spending in Brazil</h2>
        <nav>
            <a href="index.html">Home</a>
        </nav>
    </header>

    <!-- Vega Visualization: v2_map_expenses -->
    <section>
        <p>
            This graph shows the unemployment rate in SÃ£o Paulo from 2012 to 2020.
        </p>
        <figure id="Location1"></figure>
    </section>

    <!-- Vega Visualization: v3_map_expenses -->
    <section>
        <p>
            This graph shows the expenses of the Brazilian government in 2020.
        </p>
        <figure id="Location2"></figure>
    </section>

    <!-- Plotly Visualization: v3_treemap -->
    <section>
        <p>
            This treemap shows the total expenses per subarea of Brazil's healthcare spending in 2023.
        </p>
        <div id="Location3"></div>
    </section>

    <script>
        // Vega Graphs
        let figure_1_spec = "ProjectFig/v2_map_expenses.json";
        vegaEmbed('#Location1', figure_1_spec)
            .then(() => console.log("Map expenses chart loaded successfully"))
            .catch(console.error);

        let figure_2_spec = "ProjectFig/v3_map_expenses.json";
        vegaEmbed('#Location2', figure_2_spec)
            .then(() => console.log("Expenses graph loaded successfully"))
            .catch(console.error);

        // Plotly Treemap with CSV Fetch
        const treemapCSVUrl = "https://raw.githubusercontent.com/yantoniassi1/yantoniassi1.github.io/main/ProjectData/exp_subarea_total_2023.csv";

        fetch(treemapCSVUrl)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok: ' + response.statusText);
                }
                return response.text();
            })
            .then(csvText => {
                const rows = csvText.split('\n').slice(1); // Remove headers
                const labels = [];
                const parents = [];
                const values = [];

                rows.forEach(row => {
                    const [Subarea, Value, Group] = row.split(',');
                    if (Subarea && Value && Group) {
                        labels.push(Subarea.trim());
                        parents.push(Group.trim());
                        values.push(parseFloat(Value));
                    }
                });

                const treemapData = [{
                    type: 'treemap',
                    labels: labels,
                    parents: parents,
                    values: values,
                    textinfo: 'label+value+percent parent+percent root',
                    hoverinfo: 'label+value+percent parent+percent root',
                    marker: {
                        colorscale: 'Blues'
                    }
                }];

                const layout = {
                    title: 'Treemap of Total Expenses per Subarea',
                    margin: {
                        l: 10,
                        r: 10,
                        b: 10,
                        t: 50
                    }
                };

                Plotly.newPlot('Location3', treemapData, layout);
                console.log("Treemap loaded successfully");
            })
            .catch(error => {
                console.error('Error loading Treemap data:', error);
            });
    </script>
</body>

</html>

